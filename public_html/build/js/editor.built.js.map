{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./resources/assets/js/editor/main.js","webpack:///./resources/assets/js/editor/PostEditor.js","webpack:///./resources/assets/js/editor/DOMManager.js","webpack:///./resources/assets/js/editor/SelectionManager.js"],"names":["editor","PostEditor","document","querySelector","addEventListener","sel","window","getSelection","rangeCount","range","getRangeAt","console","log","startContainer","startOffset","endContainer","endOffset","editorDOM","self","domManager","DOMManager","selManager","SelectionManager","execCommand","onSelectionChanged","e","onKeyDown","onKeyUp","onPaste","body","heading","heading1","heading2","heading3","boldButton","bold","italicButton","italic","underlineButton","underline","strikeButton","strike","alignLeft","align","alignCenter","alignRight","orderedList","list","blockquote","initEditor","clipboardData","pastedData","stopPropagation","preventDefault","getData","paste","keyCode","which","selectionNode","getNodeInSelection","selPosType","getSelectionPosition","isBlockquote","pElm","generateEmptyNode","insertBefore","nextSibling","createRange","setStartBefore","firstChild","collapse","replaceRange","splitTextNode","getRange","startNode","endNode","target","newRange","setStart","setEnd","isChanged","id","firstElementChild","i","nextElementSibling","emptyNode","createElement","innerHTML","style","opacity","appendChild","removeChild","contentInside","textContent","childNodesCount","getAllNodesInSelection","length","pHolder","toolbar","unorderedList","link","tagName","elm","br","direction","chunks","node","isParagraph","isHeading","warn","textAlign","type","orgRange","nodeName","changedNode","changeNodeName","keepRange","listElm","unlockList","recordList","itemElm","isList","includes","push","childElementCount","insertNode","itemNode","nextNode","part1","part2","part3","part1ListElm","part3ListElm","part1ListElmInserted","part3ListElmInserted","part3Will","setStartAfter","contains","newParagraph","url","isAllBlockquote","isEmpty","nodeType","text","suffixNode","slice","createTextNode","splitted","split","forEach","paragraph","index","addedNode","line","replace","removeAllRanges","addRange","targetNode","newNodeName","keepStyle","newNode","replaceChild","splitText","deleteContents","isCollapsed","classList","isImageBlock","previousSibling","travelNode","nodes","isAvailableNode","parentElement"],"mappings":"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","file":"editor.built.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 10);\n","import PostEditor from \"./PostEditor\";\r\n\r\nconst editor = new PostEditor(document.querySelector('#post-editor'));\r\n\r\n// var a = document.createElement('h1').nodeName;\r\n// console.log(a);\r\n\r\ndocument.querySelector('#log-range').addEventListener('click', function () {\r\n\r\n\tvar sel = window.getSelection();\r\n\r\n\tif (sel.rangeCount === 0) {\r\n\t\treturn;\r\n\t}\r\n\r\n\tvar range = sel.getRangeAt(0);\r\n\r\n\tconsole.log(range.startContainer, range.startOffset);\r\n\tconsole.log(range.endContainer, range.endOffset);\r\n\r\n});","import DOMManager from \"./DOMManager\";\r\nimport SelectionManager from \"./SelectionManager\";\r\n\r\nexport default class PostEditor {\r\n\r\n\t/**\r\n\t * Creates a new PostEditor object.\r\n\t * @param {HTMLElement} editorDOM\r\n\t */\r\n\tconstructor (editorDOM) {\r\n\r\n\t\tlet self = this;\r\n\r\n\t\tthis.domManager = new DOMManager(editorDOM);\r\n\t\tthis.selManager = new SelectionManager(this.domManager);\r\n\r\n\t\tdocument.execCommand(\"defaultParagraphSeparator\", false, \"p\");\r\n\r\n\t\t// Event Listeners\r\n\r\n\t\tthis.domManager.editor.addEventListener('click', () => { this.onSelectionChanged(); });\r\n\t\tthis.domManager.editor.addEventListener('keydown', (e) => { this.onKeyDown(e); });\r\n\t\tthis.domManager.editor.addEventListener('keyup', (e) => {\r\n\t\t\tthis.onKeyUp(e);\r\n\t\t\tthis.onSelectionChanged();\r\n\t\t});\r\n\t\tthis.domManager.editor.addEventListener('click', () => {\r\n\t\t\tthis.onSelectionChanged();\r\n\t\t});\r\n\r\n\t\tthis.domManager.editor.addEventListener('paste', (e) => { this.onPaste(e); });\r\n\r\n\t\t// Toolbar button events\r\n\t\tthis.domManager.body.addEventListener('click', (e) => { this.selManager.heading('P'); });\r\n\t\tthis.domManager.heading1.addEventListener('click', (e) => { this.selManager.heading('H1'); });\r\n\t\tthis.domManager.heading2.addEventListener('click', (e) => { this.selManager.heading('H2'); });\r\n\t\tthis.domManager.heading3.addEventListener('click', (e) => { this.selManager.heading('H3'); });\r\n\r\n\t\tthis.domManager.boldButton.addEventListener('click', (e) => { this.selManager.bold(); });\r\n\t\tthis.domManager.italicButton.addEventListener('click', (e) => { this.selManager.italic(); });\r\n\t\tthis.domManager.underlineButton.addEventListener('click', (e) => { this.selManager.underline(); });\r\n\t\tthis.domManager.strikeButton.addEventListener('click', (e) => { this.selManager.strike(); });\r\n\r\n\t\tthis.domManager.alignLeft.addEventListener('click', (e) => { this.selManager.align('left'); });\r\n\t\tthis.domManager.alignCenter.addEventListener('click', (e) => { this.selManager.align('center'); });\r\n\t\tthis.domManager.alignRight.addEventListener('click', (e) => { this.selManager.align('right'); });\r\n\r\n\t\tthis.domManager.orderedList.addEventListener('click', (e) => { this.selManager.list('OL'); });\r\n\t\t// this.domManager.unorderedList.addEventListener('click', (e) => { this.selManager.list('UL'); });\r\n\t\tthis.domManager.blockquote.addEventListener('click', (e) => { this.selManager.blockquote('UL'); });\r\n\r\n\t\tthis.initEditor();\r\n\r\n\t}\r\n\r\n\t// Events\r\n\r\n\t/**\r\n\t *\r\n\t * @param {KeyboardEvent} e\r\n\t */\r\n\tonPaste (e) {\r\n\r\n\t\tlet clipboardData, pastedData;\r\n\r\n\t\te.stopPropagation();\r\n\t\te.preventDefault();\r\n\r\n\t\t// Get data from clipboard and conver\r\n\t\tclipboardData = e.clipboardData || window.clipboardData;\r\n\t\tpastedData = clipboardData.getData('Text');\r\n\r\n\t\tthis.selManager.paste(pastedData);\r\n\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * Fires when press keyboard inside the editor.\r\n\t * @param {KeyboardEvent} e \r\n\t */\r\n\tonKeyUp (e) {\r\n\t\t\r\n\t}\r\n\r\n\tonKeyDown (e) {\r\n\t\tvar keyCode = e.which;\r\n\r\n\t\tif (keyCode === 13) {\r\n\r\n\t\t\t// Return key\r\n\t\t\tvar selectionNode = this.selManager.getNodeInSelection();\r\n\t\t\tvar selPosType = this.selManager.getSelectionPosition()\r\n\r\n\t\t\tif (this.selManager.isBlockquote(selectionNode)) {\r\n\r\n\t\t\t\tif (selPosType === 2) {\r\n\r\n\t\t\t\t\te.stopPropagation();\r\n\t\t\t\t\te.preventDefault();\r\n\r\n\t\t\t\t\tvar pElm = this.domManager.generateEmptyNode(\"P\");\r\n\r\n\t\t\t\t\tthis.domManager.editor.insertBefore(pElm, selectionNode.nextSibling);\r\n\r\n\t\t\t\t\tvar range = document.createRange();\r\n\t\t\t\t\trange.setStartBefore(pElm.firstChild);\r\n\t\t\t\t\trange.collapse(true);\r\n\r\n\t\t\t\t\tthis.selManager.replaceRange(range);\r\n\r\n\t\t\t\t} else if (selPosType === 1) {\r\n\r\n\t\t\t\t\te.stopPropagation();\r\n\t\t\t\t\te.preventDefault();\r\n\r\n\t\t\t\t\t// this.selManager.removeSelection();\r\n\t\t\t\t\tthis.selManager.splitTextNode();\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\t\r\n\t\t}\r\n\t}\r\n\r\n\r\n\tonSelectionChanged () {\r\n\r\n\t\t// if (this.isEmpty()) {\r\n\r\n\t\t// \tconsole.log('what');\r\n\t\t// \tthis.clearEditor();\r\n\t\t// \tvar p = this.domManager.generateEmptyParagraph('p');\r\n\t\t// \tvar range = document.createRange();\r\n\t\t// \trange.setStart(p, 0);\r\n\t\t// \tthis.domManager.editor.appendChild(p);\r\n\t\t// \tthis.selManager.replaceRange(range);\r\n\t\t// \tconsole.log('Oops, editor seems empty. Now reset it to initial stat.');\r\n\t\t\r\n\t\t// }\r\n\r\n\t\t// If the selection is not in the available elements\r\n\t\t// adjust it.\r\n\t\tvar range = this.selManager.getRange();\r\n\t\tif (!range) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tvar startNode = range.startContainer;\r\n\t\tvar startOffset = range.startOffset;\r\n\t\tvar endNode = range.endContainer;\r\n\t\tvar endOffset = range.endOffset;\r\n\r\n\t\tvar target;\r\n\r\n\t\tvar newRange = document.createRange();\r\n\t\tnewRange.setStart(startNode, startOffset);\r\n\t\tnewRange.setEnd(endNode, endOffset);\r\n\r\n\t\tvar isChanged = false;\r\n\r\n\t\tif (startNode.id === 'editor-body') {\r\n\r\n\t\t\ttarget = startNode.firstElementChild;\r\n\r\n\t\t\tfor (var i = 0; i < startOffset; i++) {\r\n\t\t\t\ttarget = target.nextElementSibling;\r\n\t\t\t}\r\n\r\n\t\t\tnewRange.setStart(target, 0);\r\n\r\n\t\t\tconsole.log(target);\r\n\r\n\t\t\tisChanged = true;\r\n\t\t\t\r\n\t\t}\r\n\r\n\t\tif (endNode.id === 'editor-body') {\r\n\r\n\t\t\ttarget = endNode.firstChild;\r\n\r\n\t\t\tfor (var i = 0; i < endOffset - 1; i++) {\r\n\t\t\t\ttarget = target.nextElementSibling;\r\n\t\t\t}\r\n\r\n\t\t\tnewRange.setEnd(target, 1);\r\n\r\n\t\t\tconsole.log(target);\r\n\r\n\t\t\tisChanged = true;\r\n\t\t\t\r\n\t\t}\r\n\r\n\r\n\t\tif (isChanged) {\r\n\t\t\tthis.selManager.replaceRange(newRange);\r\n\t\t\tconsole.log(newRange);\r\n\t\t}\r\n\t\t\r\n\r\n\t}\r\n\r\n\r\n\t// Methods\r\n\r\n\t/**\r\n\t * Initialize editor.\r\n\t */\r\n\tinitEditor () {\r\n\r\n\t\t// Fix flickering when add text style first time\r\n\t\t// in Chrome browser.\r\n\t\tvar emptyNode = document.createElement('p');\r\n\t\temptyNode.innerHTML = 'a';\r\n\t\temptyNode.style.opacity = '0';\r\n\t\tthis.domManager.editor.appendChild(emptyNode);\r\n\t\tvar range = document.createRange();\r\n\t\trange.setStart(emptyNode.firstChild, 0);\r\n\t\trange.setEnd(emptyNode.firstChild, 1);\r\n\t\tthis.selManager.replaceRange(range);\r\n\t\tdocument.execCommand('bold', false);\r\n\t\tthis.domManager.editor.removeChild(emptyNode);\r\n\r\n\t\t// if (this.isEmpty()) {\r\n\t\t// \tthis.domManager.editor.innerHTML = \"\";\r\n\t\t// \tvar emptyP = this.domManager.generateEmptyParagraph('p');\r\n\t\t// \tthis.domManager.editor.appendChild(emptyP);\r\n\r\n\t\t// \tvar range = document.createRange();\r\n\t\t// \trange.setStartBefore(emptyP);\r\n\t\t// \trange.collapse(true);\r\n\r\n\t\t// \tthis.selManager.sel.removeAllRanges();\r\n\t\t// \tthis.selManager.sel.addRange(range);\r\n\t\t// }\r\n\t\t\r\n\t}\r\n\r\n\tclearEditor () {\r\n\r\n\t\tthis.domManager.editor.innerHTML = \"\";\r\n\r\n\t}\r\n\t\r\n\r\n\t/**\r\n\t * Return true if the editor is empty.\r\n\t */\r\n\tisEmpty () {\r\n\t\tlet contentInside = this.domManager.editor.textContent;\r\n\t\tlet childNodesCount = this.selManager.getAllNodesInSelection().length;\r\n\t\tif (contentInside === \"\" && childNodesCount < 1) {\r\n\t\t\treturn true;\r\n\t\t} else {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t}\r\n\r\n}\r\n","export default class DOMManager {\r\n\r\n\t/**\r\n\t * Manages html DOM.\r\n\t * @param {HTMLElement} editorDOM\r\n\t */\r\n\tconstructor (editorDOM) {\r\n\r\n\t\tthis.pHolder = document.createElement('p');\r\n\t\tthis.pHolder.innerHTML = '<br>';\r\n\r\n\t\t// Editor body\r\n\t\tthis.editor = editorDOM.querySelector('#editor-body');\r\n\r\n\t\t// Toolbar\r\n\t\tthis.toolbar = editorDOM.querySelector('#editor-toolbar');\r\n\r\n\t\t// Toolbar buttons\r\n\t\tthis.body = this.toolbar.querySelector('#p');\r\n\t\tthis.heading1 = this.toolbar.querySelector('#h1');\r\n\t\tthis.heading2 = this.toolbar.querySelector('#h2');\r\n\t\tthis.heading3 = this.toolbar.querySelector('#h3');\r\n\r\n\t\tthis.boldButton = this.toolbar.querySelector('#bold');\r\n\t\tthis.italicButton = this.toolbar.querySelector('#italic');\r\n\t\tthis.underlineButton = this.toolbar.querySelector('#underline');\r\n\t\tthis.strikeButton = this.toolbar.querySelector('#strike');\r\n\r\n\t\tthis.alignLeft = this.toolbar.querySelector('#align-left');\r\n\t\tthis.alignCenter = this.toolbar.querySelector('#align-center');\r\n\t\tthis.alignRight = this.toolbar.querySelector('#align-right');\r\n\r\n\t\tthis.orderedList = this.toolbar.querySelector('#ol');\r\n\t\tthis.unorderedList = this.toolbar.querySelector('#ul');\r\n\r\n\t\tthis.link = this.toolbar.querySelector('#link');\r\n\t\tthis.blockquote = this.toolbar.querySelector('#blockquote');\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param  {String} tagName\r\n\t * @return {HTMLElement}\r\n\t */\r\n\tgenerateEmptyNode (tagName) {\r\n\t\tlet elm = document.createElement(tagName);\r\n\t\tlet br = document.createElement('br');\r\n\t\telm.appendChild(br);\r\n\t\treturn elm;\r\n\t}\r\n\r\n}","export default class SelectionManager {\r\n\r\n\t/**\r\n\t * \r\n\t * @param {DOMManager} domManager \r\n\t */\r\n\tconstructor (domManager) {\r\n\r\n\t\tthis.sel = document.getSelection();\r\n\t\tthis.range;\r\n\t\tthis.startNode;\r\n\t\tthis.startOffset;\r\n\t\tthis.endNode;\r\n\t\tthis.endOffset;\r\n\r\n\t\tthis.domManager = domManager;\r\n\r\n\t}\r\n\r\n\t// Events\r\n\r\n\r\n\r\n\t// Methods\r\n\r\n\t/**\r\n\t * Align the selected paragraph.\r\n\t * @param {String} direction\r\n\t * Left, Center, Right\r\n\t */\r\n\talign (direction) {\r\n\r\n\t\t// document.execCommand('styleWithCSS', true);\r\n\t\t// document.execCommand(direction, false);\r\n\r\n\t\tvar chunks = this.getAllNodesInSelection();\r\n\t\tvar node;\r\n\r\n\t\tfor (var i = 0; i < chunks.length; i++) {\r\n\r\n\t\t\tif (!this.isParagraph(chunks[i]) && !this.isHeading(chunks[i])) {\r\n\t\t\t\tconsole.warn('The node is not a paragraph nor a heading.')\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\tchunks[i].style.textAlign = direction;\r\n\r\n\t\t}\r\n\t\t\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * Make the selection bold.\r\n\t */\r\n\tbold () {\r\n\t\tdocument.execCommand('bold', false);\r\n\t}\r\n\r\n\t/**\r\n\t * Make the selection italics.\r\n\t */\r\n\titalic () {\r\n\t\tdocument.execCommand('italic', false);\r\n\t}\r\n\r\n\tunderline () {\r\n\t\tdocument.execCommand('underline', false);\r\n\t}\r\n\r\n\tstrike () {\r\n\t\tdocument.execCommand('strikeThrough', false);\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param {string} type \r\n\t */\r\n\theading (type) {\r\n\r\n\t\t// # 버그\r\n\t\t// 엔터 치고 첫번째 줄과 두번째 빈 줄 셀렉트 하고\r\n\t\t// heading 적용 시 range 유지 안됨. range가 document 벗어났다고 에러뜸.\r\n\t\t// -> 빈 태그는 heading 적용하지 않음.\r\n\t\t\r\n\t\tlet orgRange = this.getRange();\r\n\t\tif (!orgRange) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tlet startNode = orgRange.startContainer;\r\n\t\tlet startOffset = orgRange.startOffset;\r\n\t\tlet endNode = orgRange.endContainer;\r\n\t\tlet endOffset = orgRange.endOffset;\r\n\t\tlet chunks = this.getAllNodesInSelection();\r\n\r\n\t\t\r\n\r\n\t\tfor (var i = 0; i < chunks.length; i++) {\r\n\r\n\t\t\tif (chunks[i].nodeName === type) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\t// if (chunks[i].textContent === \"\") {\r\n\t\t\t// \tcontinue;\r\n\t\t\t// }\r\n\r\n\t\t\tif (\r\n\t\t\t\t!this.isParagraph(chunks[i]) &&\r\n\t\t\t\t!this.isHeading(chunks[i]) &&\r\n\t\t\t\t!this.isBlockquote(chunks[i])\r\n\t\t\t) {\r\n\t\t\t\tconsole.warn('The node is not a paragraph nor a heading.')\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\tvar changedNode = this.changeNodeName(chunks[i], type);\r\n\t\t\tif (chunks[i] === startNode) {\r\n\t\t\t\tstartNode = changedNode;\r\n\t\t\t}\r\n\t\t\tif (chunks[i] === endNode) {\r\n\t\t\t\tendNode = changedNode;\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\t\r\n\t\tvar keepRange = document.createRange();\r\n\t\tkeepRange.setStart(startNode, startOffset);\r\n\t\tkeepRange.setEnd(endNode, endOffset);\r\n\t\tthis.replaceRange(keepRange);\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param {string} type \r\n\t */\r\n\tlist (type) {\r\n\r\n\t\t// If one or more lists are\r\n\t\t// included in the selection,\r\n\t\t// add other chunks to the existing list.\r\n\r\n\t\t// If all selection is already a list\r\n\t\t// restore them to 'P' node.\r\n\r\n\t\tlet orgRange = this.getRange();\r\n\t\tif (!orgRange) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tlet startNode = orgRange.startContainer;\r\n\t\tlet startOffset = orgRange.startOffset;\r\n\t\tlet endNode = orgRange.endContainer;\r\n\t\tlet endOffset = orgRange.endOffset;\r\n\r\n\t\tlet chunks = this.getAllNodesInSelection();\r\n\t\tlet listElm = document.createElement(type);\r\n\t\tvar node;\r\n\r\n\t\tvar unlockList = true;\r\n\t\tvar recordList = [];\r\n\r\n\t\tfor (var i = 0; i < chunks.length; i++) {\r\n\r\n\t\t\tif (chunks[i].textContent === \"\") {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\tif (\r\n\t\t\t\tthis.isParagraph(chunks[i]) ||\r\n\t\t\t\tthis.isHeading(chunks[i])\r\n\t\t\t) {\r\n\r\n\t\t\t\tvar itemElm = document.createElement('LI');\r\n\r\n\t\t\t\twhile (node = chunks[i].firstChild) {\r\n\r\n\t\t\t\t\titemElm.appendChild(node);\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (chunks[i] === startNode) {\r\n\t\t\t\t\tstartNode = itemElm;\r\n\t\t\t\t}\r\n\t\r\n\t\t\t\tif (chunks[i] === endNode) {\r\n\t\t\t\t\tendNode = itemElm;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlistElm.appendChild(itemElm);\r\n\r\n\t\t\t\tthis.domManager.editor.removeChild(chunks[i]);\r\n\r\n\t\t\t\tunlockList = false;\r\n\r\n\t\t\t} else if (this.isList(chunks[i])) {\r\n\r\n\t\t\t\t// If the node is already a list\r\n\t\t\t\t// move items inside to the new list element.\r\n\r\n\t\t\t\tif (!recordList.includes(chunks[i])) {\r\n\t\t\t\t\trecordList.push(chunks[i]);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (recordList.length > 1) {\r\n\t\t\t\t\tunlockList = false;\r\n\t\t\t\t}\r\n\r\n\t\t\t\twhile (node = chunks[i].firstChild) {\r\n\r\n\t\t\t\t\tlistElm.appendChild(node);\r\n\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\r\n\t\t\t\tthis.domManager.editor.removeChild(chunks[i]);\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tif (listElm.childElementCount < 1) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.getRange().insertNode(listElm);\r\n\r\n\t\tif (unlockList) {\r\n\r\n\t\t\tvar range = document.createRange();\r\n\t\t\tvar itemNode, nextNode;\r\n\t\t\tvar part1 = true, part2 = false, part3 = false;\r\n\t\t\tvar part1ListElm = document.createElement('OL'), part3ListElm = document.createElement('OL');\r\n\t\t\tvar part1ListElmInserted = false, part3ListElmInserted = false;\r\n\t\t\tvar part3Will = false;\r\n\r\n\t\t\trange.setStartAfter(listElm);\r\n\t\t\tthis.replaceRange(range);\r\n\r\n\t\t\titemNode = listElm.firstChild;\r\n\t\t\tnextNode = itemNode;\r\n\r\n\t\t\twhile (itemNode) {\r\n\r\n\r\n\t\t\t\tnextNode = itemNode.nextElementSibling;\r\n\r\n\t\t\t\tif (itemNode.nodeName !== \"LI\") {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (itemNode.contains(startNode)) {\r\n\t\t\t\t\tpart1 = false;\r\n\t\t\t\t\tpart2 = true;\r\n\t\t\t\t\tpart3 = false;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (itemNode.contains(endNode)) {\r\n\t\t\t\t\tpart3Will = true;\r\n\t\t\t\t}\r\n\r\n\r\n\r\n\r\n\r\n\t\t\t\tif (part1) {\r\n\r\n\t\t\t\t\tpart1ListElm.appendChild(itemNode);\r\n\r\n\t\t\t\t\tif (!part1ListElmInserted) {\r\n\t\t\t\t\t\trange.insertNode(part1ListElm);\r\n\t\t\t\t\t\trange.setStartAfter(part1ListElm);\r\n\t\t\t\t\t\tpart1ListElmInserted = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t} else if (part2) {\r\n\r\n\t\t\t\t\tvar pElm = document.createElement('P');\r\n\t\t\t\t\twhile (node = itemNode.firstChild) {\r\n\t\t\t\t\t\tpElm.appendChild(node)\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\trange.insertNode(pElm);\r\n\t\t\t\t\trange.setStartAfter(pElm);\r\n\r\n\t\t\t\t} else if (part3) {\r\n\r\n\t\t\t\t\tpart3ListElm.appendChild(itemNode);\r\n\t\t\t\t\t\r\n\t\t\t\t\tif (!part3ListElmInserted) {\r\n\t\t\t\t\t\trange.insertNode(part3ListElm);\r\n\t\t\t\t\t\trange.setStartAfter(part3ListElm);\r\n\t\t\t\t\t\tpart3ListElmInserted = true;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (itemNode === startNode) {\r\n\t\t\t\t\tstartNode = newParagraph;\r\n\t\t\t\t}\r\n\t\r\n\t\t\t\tif (itemNode === endNode) {\r\n\t\t\t\t\tendNode = newParagraph;\r\n\t\t\t\t}\r\n\r\n\t\t\t\r\n\r\n\t\t\t\tif (part3Will) {\r\n\t\t\t\t\tpart1 = false;\r\n\t\t\t\t\tpart2 = false;\r\n\t\t\t\t\tpart3 = true;\r\n\t\t\t\t}\r\n\t\t\t\r\n\r\n\t\t\t\titemNode = nextNode;\r\n\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif (this.domManager.editor.contains(listElm)) {\r\n\t\t\t\tthis.domManager.editor.removeChild(listElm);\r\n\t\t\t}\r\n\t\t\t\r\n\r\n\t\t}\r\n\r\n\t\tvar keepRange = document.createRange();\r\n\t\tkeepRange.setStart(startNode, startOffset);\r\n\t\tkeepRange.setEnd(endNode, endOffset);\r\n\r\n\t\tthis.replaceRange(keepRange);\r\n\r\n\t}\r\n\r\n\tlink (url) {\r\n\t\tdocument.execCommand('createLink', false, url);\r\n\t}\r\n\r\n\tblockquote () {\r\n\t\tlet orgRange = this.getRange();\r\n\t\tif (!orgRange) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tlet startNode = orgRange.startContainer;\r\n\t\tlet startOffset = orgRange.startOffset;\r\n\t\tlet endNode = orgRange.endContainer;\r\n\t\tlet endOffset = orgRange.endOffset;\r\n\t\tlet chunks = this.getAllNodesInSelection();\r\n\r\n\t\tvar isAllBlockquote = true;\r\n\r\n\t\tfor (var i = 0; i < chunks.length; i++) {\r\n\r\n\t\t\tif (chunks[i].nodeName === \"BLOCKQUOTE\") {\r\n\t\t\t\tcontinue;\r\n\t\t\t} else {\r\n\t\t\t\tisAllBlockquote = false;\r\n\t\t\t}\r\n\r\n\t\t\t// if (chunks[i].textContent === \"\") {\r\n\t\t\t// \tcontinue;\r\n\t\t\t// }\r\n\r\n\t\t\tif (!this.isParagraph(chunks[i]) && !this.isHeading(chunks[i])) {\r\n\t\t\t\tconsole.warn('The node is not a paragraph nor a heading.')\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\tvar changedNode = this.changeNodeName(chunks[i], \"blockquote\", false);\r\n\t\t\tif (chunks[i] === startNode) {\r\n\t\t\t\tstartNode = changedNode;\r\n\t\t\t}\r\n\t\t\tif (chunks[i] === endNode) {\r\n\t\t\t\tendNode = changedNode;\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\t// Selection is all blockquote\r\n\t\tif (isAllBlockquote) {\r\n\t\t\tfor (var i = 0; i < chunks.length; i++) {\r\n\t\t\t\tvar changedNode = this.changeNodeName(chunks[i], \"P\", false);\r\n\t\t\t\tif (chunks[i] === startNode) {\r\n\t\t\t\t\tstartNode = changedNode;\r\n\t\t\t\t}\r\n\t\t\t\tif (chunks[i] === endNode) {\r\n\t\t\t\t\tendNode = changedNode;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\r\n\t\tvar keepRange = document.createRange();\r\n\t\tkeepRange.setStart(startNode, startOffset);\r\n\t\tkeepRange.setEnd(endNode, endOffset);\r\n\t\tthis.replaceRange(keepRange);\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * Deprecated\r\n\t */\r\n\tbackspace () {\r\n\r\n\t\t// this.range.deleteContents();\r\n\r\n\t\t// If the selection is collapsed\r\n\t\t// implement default delete action.\r\n\t\tif (this.isEmpty()) {\r\n\t\t\tconsole.log(this.startOffset);\r\n\t\t\tif (this.startOffset === 0) {\r\n\t\t\t\t// If the selection is on the beginning\r\n\t\t\t\t\r\n\t\t\t} else {\r\n\t\t\t\tif (this.startNode.nodeType === 3) {\r\n\t\t\t\t\tconsole.log(this.startNode);\r\n\t\t\t\t\t// TextNode\r\n\t\t\t\t\tvar text = this.startNode.textContent;\r\n\t\t\t\t\tvar suffixNode;\r\n\t\t\t\t\tvar newRange = document.createRange();\r\n\r\n\t\t\t\t\tthis.startNode.textContent\r\n\t\t\t\t\t= text.slice(0, this.startOffset - 1) + text.slice(this.startOffset, text.length);\r\n\t\t\t\t\t\r\n\t\t\t\t\tnewRange.setEnd(this.startNode, this.startOffset - 1);\r\n\t\t\t\t\tnewRange.collapse(false);\r\n\t\t\t\t\tnewRange.insertNode((suffixNode = document.createTextNode(' ')));\r\n\t\t\t\t\tnewRange.setStartAfter(suffixNode);\r\n\r\n\t\t\t\t\tconsole.log(this.startOffset);\r\n\r\n\t\t\t\t\tthis.replaceRange(newRange);\r\n\t\t\t\t\t\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\r\n\t}\r\n\r\n\tdelete () {\r\n\t\t\r\n\t}\r\n\r\n\tenter () {\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Paste refined data to the selection.\r\n\t * @param {String} pastedData\r\n\t */\r\n\tpaste (pastedData) {\r\n\r\n\t\tlet splitted = pastedData.split(/(?:\\r\\n|\\r|\\n)/g);\r\n\r\n\t\tvar range = document.createRange();\r\n\t\trange = this.getRange();\r\n\r\n\t\tsplitted.forEach( (paragraph, index) => {\r\n\r\n\t\t\tvar addedNode;\r\n\r\n\t\t\tvar line = paragraph;\r\n\r\n\t\t\tif (index === 0) {\r\n\t\t\t\t// line = line.replace(/\\s/g, \"&nbsp;\");\r\n\t\t\t\taddedNode = document.createTextNode(line);\r\n\t\t\t} else {\r\n\t\t\t\taddedNode = document.createElement('p');\r\n\t\t\t\tline = line.replace(/\\s/g, \"&nbsp;\");\r\n\t\t\t\tif (line === \"\") {\r\n\t\t\t\t\tline = \"<br>\";\r\n\t\t\t\t}\r\n\t\t\t\taddedNode.innerHTML = line;\r\n\t\t\t}\r\n\r\n\t\t\trange.insertNode(addedNode);\r\n\r\n\t\t\trange.setStartAfter(addedNode);\r\n\r\n\t\t});\r\n\r\n\t\t// console.log(splitted);\r\n\r\n\t\t// pastedData = pastedData.replace(/(?:\\r\\n|\\r|\\n)/g, '<br>');\r\n \r\n\t}\r\n\r\n\r\n\r\n\tclearRange () {\r\n\t\tdocument.getSelection().removeAllRanges();\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @param {Range} range \r\n\t */\r\n\treplaceRange (range) {\r\n\t\tdocument.getSelection().removeAllRanges();\r\n\t\tdocument.getSelection().addRange(range);\r\n\t}\r\n\r\n\t/**\r\n\t * Replace the node if the node is inside the editor,\r\n\t * else return the new node.\r\n\t * @param {HTMLElement} targetNode An HTML element you want to change its node name.\r\n\t * @param {String} newNodeName New node name for the target element.\r\n\t */\r\n\tchangeNodeName (targetNode, newNodeName, keepStyle = true) {\r\n\r\n\t\t// Move all the nodes inside the target node\r\n\t\t// to the new generated node with new node name,\r\n\t\t// as well as preserving the range\r\n\t\t// if the startContainer or the endContainer are included\r\n\t\t// in the original node.\r\n\r\n\t\tif (targetNode.nodeType !== 1) {\r\n\t\t\t// If the node is not an HTML element do nothing.\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// 1. Change node\r\n\t\tvar node;\r\n\t\tvar newNode = document.createElement(newNodeName);\r\n\r\n\t\tif (keepStyle) {\r\n\t\t\tnewNode.style.textAlign = targetNode.style.textAlign;\r\n\t\t}\r\n\t\t\r\n\r\n\t\twhile (node = targetNode.firstChild) {\r\n\t\t\tnewNode.appendChild(node);\r\n\t\t}\r\n\r\n\t\t// 3. replace node\r\n\t\tthis.domManager.editor.replaceChild(newNode, targetNode);\r\n\r\n\t\treturn newNode;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Update selection information.\r\n\t */\r\n\tupdateSelection () {\r\n\r\n\r\n\t}\r\n\r\n\tfixSelection () {\r\n\t\t\r\n\t\t\r\n\t}\r\n\r\n\tsplitElementNode () {\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Split text nodes based on the selection.\r\n\t */\r\n\tsplitTextNode () {\r\n\t\tconsole.log('split');\r\n\t\tvar range = this.getRange();\r\n\t\tif (!range) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar startNode = range.startContainer;\r\n\t\tvar startOffset = range.startOffset;\r\n\t\t\r\n\r\n\t\tif (startNode.nodeType === 3 && startOffset > 0) {\r\n\t\t\tstartNode.splitText(startOffset);\r\n\t\t}\r\n\r\n\t\trange = this.getRange();\r\n\t\tvar endNode = range.endContainer;\r\n\t\tvar endOffset = range.endOffset;\r\n\r\n\t\tif (endNode.nodeType === 3 && endOffset < endNode.textContent.length) {\r\n\t\t\tendNode.splitText(endOffset);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Remove selection.\r\n\t */\r\n\tremoveSelection () {\r\n\t\tthis.getRange().deleteContents();\r\n\t}\r\n\r\n\t/**\r\n\t * Return true if the selection is empty.\r\n\t */\r\n\tisEmpty () {\r\n\t\tif (document.getSelection().isCollapsed) {\r\n\t\t\treturn true;\r\n\t\t} else {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * Determine if the given node is a paragraph node which Povium understands.\r\n\t * @param {Node} node\r\n\t */\r\n\tisParagraph (node) {\r\n\t\tif (!node) {\r\n\t\t\treturn false;\r\n\t\t} else if (node.nodeName === 'P') {\r\n\t\t\treturn true;\r\n\t\t} else {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t}\r\n\r\n\tisHeading (node) {\r\n\t\tif (!node) {\r\n\t\t\treturn false;\r\n\t\t} else if (\r\n\t\t\tnode.nodeName === 'H1' ||\r\n\t\t\tnode.nodeName === 'H2' ||\r\n\t\t\tnode.nodeName === 'H3' ||\r\n\t\t\tnode.nodeName === 'H4' ||\r\n\t\t\tnode.nodeName === 'H5' ||\r\n\t\t\tnode.nodeName === 'H6'\r\n\t\t) {\r\n\t\t\treturn true;\r\n\t\t} else {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t}\r\n\r\n\tisList (node) {\r\n\t\tif (!node) {\r\n\t\t\treturn false;\r\n\t\t} else if (\r\n\t\t\tnode.nodeName === 'OL' ||\r\n\t\t\tnode.nodeName === 'UL'\r\n\t\t) {\r\n\t\t\treturn true;\r\n\t\t} else {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t}\r\n\r\n\tisBlockquote (node) {\r\n\t\tif (!node) {\r\n\t\t\treturn false;\r\n\t\t} else if (node.nodeName === 'BLOCKQUOTE') {\r\n\t\t\treturn true;\r\n\t\t} else {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Returns true if the node is an available image block.\r\n\t * @param {HTMLElement} node \r\n\t */\r\n\tisImageBlock (node) {\r\n\t\tif (!node) {\r\n\t\t\treturn false;\r\n\t\t} else if (node.classList && node.classList.contains('image-block')) {\r\n\t\t\treturn true;\r\n\t\t} else {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t}\r\n\r\n\tisAvailableNode (node) {\r\n\t\tif (\r\n\t\t\tthis.isParagraph(node) ||\r\n\t\t\tthis.isHeading(node) ||\r\n\t\t\tthis.isList(node) ||\r\n\t\t\tthis.isBlockquote(node) ||\r\n\t\t\tthis.isImageBlock(node)\r\n\t\t) {\r\n\t\t\treturn true;\r\n\t\t} else {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t}\r\n\r\n\tgetSelectionPosition () {\r\n\t\tvar orgRange = this.getRange();\r\n\t\tvar startNode = orgRange.startContainer;\r\n\t\tvar startOffset = orgRange.startOffset;\r\n\t\tvar endNode = orgRange.endContainer;\r\n\t\tvar endOffset = orgRange.endOffset;\r\n\r\n\t\tif (!endNode.nextSibling && endNode.textContent.length === endOffset) {\r\n\t\t\t// console.log('end of the line');\r\n\t\t\treturn 2;\r\n\t\t} else if (!startNode.previousSibling && startOffset === 0) {\r\n\t\t\t// console.log('start of the line');\r\n\t\t\treturn 0;\r\n\t\t} else {\r\n\t\t\t// console.log('middle of the night');\r\n\t\t\treturn 1;\r\n\t\t}\r\n\t}\r\n\r\n\r\n\r\n\r\n\t// Getters\r\n\r\n\r\n\t/**\r\n\t * @return {Selection}\r\n\t */\r\n\tgetSelection () {\r\n\t\treturn document.getSelection();\r\n\t}\r\n\r\n\t\r\n\t/**\r\n\t * @return {Range}\r\n\t */\r\n\tgetRange () {\r\n\t\tif (document.getSelection().rangeCount > 0) {\r\n\t\t\treturn document.getSelection().getRangeAt(0);\r\n\t\t} else {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Returns an array of all available nodes within the selection.\r\n\t * @return {Array.<HTMLElement>}\r\n\t */\r\n\tgetAllNodesInSelection () {\r\n\r\n\t\tlet travelNode = this.getRange() ? this.getRange().startContainer : null;\r\n\t\tlet nodes = [];\r\n\r\n\t\twhile (1) {\r\n\r\n\r\n\t\t\tif (!travelNode) {\r\n\t\t\t\tbreak;\r\n\t\t\t} else if (this.isAvailableNode(travelNode)) {\r\n\t\t\t\tnodes.push(travelNode);\r\n\t\t\t\tif (travelNode.contains(this.getRange().endContainer)) {\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t} else {\r\n\t\t\t\t\ttravelNode = travelNode.nextElementSibling;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t} else {\r\n\t\t\t\ttravelNode = travelNode.parentElement;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t// if (!travelNode || travelNode.nodeName === 'BODY') {\r\n\r\n\t\t\t// \tbreak;\r\n\r\n\t\t\t// } else if (travelNode.id === 'editor-body') {\r\n\r\n\t\t\t// \ttravelNode = travelNode.firstChild;\r\n\r\n\t\t\t// } else if (this.isAvailableNode(travelNode)) {\r\n\t\t\t// \tnodes.push(travelNode);\r\n\t\t\t\t\r\n\t\t\t// \tif (travelNode.contains(this.getRange().endContainer)) {\r\n\t\t\t// \t\tbreak;\r\n\t\t\t// \t} else {\r\n\t\t\t// \t\ttravelNode = travelNode.nextElementSibling;\r\n\t\t\t// \t}\r\n\r\n\t\t\t// } else if (travelNode.nextElementSibling === null) {\r\n\t\t\t// \ttravelNode = travelNode.parentNode;\r\n\t\t\t// } else {\r\n\t\t\t// \ttravelNode = travelNode.nextElementSibling;\r\n\t\t\t// }\r\n\r\n\t\t}\r\n\r\n\t\treturn nodes;\r\n\r\n\t}\r\n\r\n\tgetNodeInSelection () {\r\n\r\n\t\tvar travelNode = this.getRange().startContainer;\r\n\t\tif (!travelNode) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\twhile (1) {\r\n\t\t\tif (this.isAvailableNode(travelNode)) {\r\n\t\t\t\treturn travelNode;\r\n\t\t\t\tbreak;\r\n\t\t\t} else {\r\n\t\t\t\ttravelNode = travelNode.parentElement;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tgetCursorPosInParagraph () {\r\n\t\tif (this.startOffset === 0) {\r\n\t\t\t// If the selection is on the beginning\r\n\t\t\treturn 1;\r\n\t\t} else {\r\n\t\t\treturn\r\n\t\t}\r\n\t}\r\n\r\n}"],"sourceRoot":""}